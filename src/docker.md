# Simple Docker

Введение в докер. Разработка простого докер образа для собственного сервера.


## Contents


1. [Готовый докер](#part-1-готовый-докер) 
2. [Операции с контейнером](#part-2-операции-с-контейнером) 
3. [Мини веб-сервер](#part-3-мини-веб-сервер) 
4. [Свой докер](#part-4-свой-докер) 
5. [Dockle](#part-5-dockle) 
6. [Базовый Docker Compose](#part-6-базовый-docker-compose)

## Part 1. Готовый докер ##

1. Взять официальный докер образ с nginx и выкачать его при помощи docker pull

![1.1](https://i.imgur.com/Xtx2cHF.png "1.1 docker pull используется для скачивания образа Docker из удаленного реестра (registry) в локальное хранилище Docker на машине.")

2. Проверить наличие докер образа через docker images

![1.2](https://i.imgur.com/ODCYP7n.png "1.2 docker images выводит список всех доступных образов Docker, которые находятся на локальной машине. Она показывает информацию об идентификаторе образа, теге, размере, дате создания и репозитории, к которому принадлежит образ. " )

3. Запустить докер образ через docker run -d [image_id|repository]

![1.3](https://i.imgur.com/khDx1e7.png "1.3 run -d [image_id|repository] запускает контейнер в фоновом режиме (detached mode). Она используется для запуска нового контейнера из определенного образа или репозитория в фоновом режиме, без привязки к текущему терминалу.")

4. Проверить, что образ запустился через docker ps

![1.4](https://i.imgur.com/KcsB1Ku.png "1.4 docker ps выводит список работающих контейнеров Docker на текущей машине. Это позволяет пользователю просмотреть идентификаторы контейнеров, названия, используемые ресурсы, статус выполнения и другую информацию о контейнерах. ")

5. Посмотреть информацию о контейнере через docker inspect [container_id|container_name]

![1.5](https://i.imgur.com/USeWHdM.png "1.5 docker inspect используется для получения подробной информации о контейнере Docker. Она позволяет просмотреть все настройки, метаданные и конфигурацию контейнера. ")

6. По выводу команды определить и поместить в отчёт размер контейнера, список замапленных портов и ip контейнера

размер контейнера: 67108864 байт 
список замапленных портов: 80/tcp
ip контейнера: 172.17.0.2

7. Остановить докер образ через docker stop [container_id|container_name]

![1.6](https://i.imgur.com/SFbDLDZ.png "1.6 docker stop останавливает работу контейнера Docker по его ID или имени. Когда контейнер останавливается, все процессы внутри него завершаются и контейнер переходит в неактивное состояние.")

8. Проверить, что образ остановился через docker ps

![1.7](https://i.imgur.com/2J9OVb0.png "1.7 Образ остановлен поэтому список пуст")

9. Запустить докер с портами 80 и 443 в контейнере, замапленными на такие же порты на локальной машине, через команду run

![1.8](https://i.imgur.com/Xoc4TEK.png "1.8 Для добавления портов в контейнер Docker через команду run, используем флаг -p или --publish.")

10. Проверить, что в браузере по адресу localhost:80 доступна стартовая страница nginx

![1.9](https://i.imgur.com/V8u3WtT.png "1.9 Через веб-браузер по адресу локальной сети через порт 80, мы зашли на стартовую страничку nginx")

11. Перезапустить докер контейнер через docker restart [container_id|container_name]

![1.10](https://i.imgur.com/5lz6CJz.png "1.10 docker restart используется для перезапуска контейнера Docker. Она прекращает выполнение контейнера, а затем запускает его снова с теми же настройками и параметрами, которые были определены при его первоначальном запуске.")

12. Проверить любым способом, что контейнер запустился 

![1.11](https://i.imgur.com/E2mWYa8.png "1.11 STATUS Up, это значит что контейнер запущен")

## Part 2. Операции с контейнером ##

1. Прочитать конфигурационный файл nginx.conf внутри докер контейнера через команду exec

![2.1](https://i.imgur.com/bxcbbHd.png "2.1 Команда docker exec -it используется для выполнения команд внутри контейнера Docker. exec сообщает Docker'у, что нужно выполнить команду внутри контейнера. -it указывает Docker'у, что команда должна быть выполнена в интерактивном режиме с подключением к терминалу контейнера." )

![2.2](https://i.imgur.com/afQGlcd.png "2.2 nginx.conf - это файл конфигурации главного веб-сервера Nginx. В этом файле определяются основные настройки сервера, такие как порт, каталоги для статических файлов, обработка запросов, проксирование и многое другое.")

2. Создать на локальной машине файл nginx.conf
3. Настроить в нем по пути /status отдачу страницы статуса сервера nginx

![2.3](https://i.imgur.com/gDtorKs.png "2.3 В данном конфигурационном блоке для сервера Nginx на порту 80 определены следующие параметры: listen: определяет IP адрес и порт, на котором сервер будет слушать запросы. 80 указывает на стандартный HTTP порт. [::] указывает на прослушивание запросов с помощью IPv6. server_name: указывает доменное имя или IP адрес, на которое сервер будет отвечать. В данном случае указано localhost, что означает, что сервер будет отвечать на запросы, адресованные локальному компьютеру. location /: определяет точку входа для всех запросов, которые не совпали с другими location блоками. Здесь указаны параметры для обработки запросов, направляемых в корень сайта. root указывает на директорию, в которой находятся файлы сайта, и index указывает на файл(ы), который будет отображаться в случае отсутствия указанного файла в URL запроса. location /status: определяет URL-путь, по которому будет доступна статистика о текущем состоянии сервера. Параметр stub_status указывает на включение статуса Nginx для данного location.")

4. Скопировать созданный файл nginx.conf внутрь докер образа через команду docker cp
5. Перезапустить nginx внутри докер образа через команду exec

![2.4.1](https://i.imgur.com/TO639Hw.png "2.4 docker cp предназначена для копирования файлов и папок между контейнером Docker и локальной машиной или между контейнерами Docker. Она позволяет перемещать файлы и папки внутри контейнера или между контейнером и хостовой машиной. команда ng  nginx -s reload выполняется внутри контейнера с именем ng. Она используется для перезагрузки конфигурации Nginx без перезапуска контейнера.")

6. Проверить, что по адресу localhost:80/status отдается страничка со статусом сервера nginx

![2.5](https://i.imgur.com/XjoD29G.png "2.5 Страничка со статусом сервера nginx отдается")

7. Экспортировать контейнер в файл container.tar через команду export

![2.8](https://i.imgur.com/wspUky7.png "2.7  Данная команда экспортирует файловую систему Docker-контейнера с именем nd в файл container.tar. Экспорт включает все слои файловой системы, находящиеся в контейнере.")

8. Удалить образ через docker rmi [image_id|repository], не удаляя перед этим контейнеры
9. Удалить остановленный контейнер

![2.6](https://i.imgur.com/YfY4x9s.png "2.7 docker stop используется для остановки контейнера Docker. Команда docker rmi используется для удаления одного или нескольких образов Docker. Она принимает аргументы:-f (или --force) - указывает Docker-у на принудительное удаление образа, даже если он используется в контейнерах.image_id - идентификатор (ID) образа Docker, который требуется удалить. repository - имя репозитория образа, который требуется удалить.")

10. Импортировать контейнер обратно через команду import
11. Запустить импортированный контейнер

![2.7](https://i.imgur.com/zQP7Z5f.png "2.8 docker import - это команда в Docker, которая позволяет создать новый образ Docker из архивного файла или из файласистемы на локальном диске. Команда docker start в Docker используется для запуска остановленных контейнеров. ")

12. Проверить, что по адресу localhost:80/status отдается страничка со статусом сервера nginx
![2.9](https://i.imgur.com/fW4kL5E.png "2.9 Страничка со статусом сервера nginx отдается")

## Part 3. Мини веб-сервер ##

1. Написать мини сервер на C и FastCgi, который будет возвращать простейшую страничку с надписью Hello World!

![3.1](https://i.imgur.com/dvpgIU6.png "3.1 fcgi_stdio.h: Включает заголовочный файл fcgi_stdio.h, который содержит функции и определения для работы с FastCGI. while(FCGI_Accept() >= 0) { ... }: Запускает бесконечный цикл, пока FCGI_Accept() возвращает значение больше или равное нулю. FCGI_Accept() используется для принятия и обработки нового запроса FastCGI.")

2. Запустить написанный мини сервер через spawn-fcgi на порту 8080

Нужно установить библиотеку fcgi и утилиту spawn-fcgi:
apt-get install libfcgi-dev
apt install spawn-fcgi

![3.2](https://i.imgur.com/8q6YRLx.png "3.2 Копируем файл в контейнер ")
![3.3](https://i.imgur.com/RDRmjTW.png "3.3 Компилируем файл main.c, опция -lfcgi указывает компилятору использовать библиотеку fcgi при сборке программы.")
![3.4](https://i.imgur.com/X5n0Myj.png "3.4 Команда spawn-fcgi используется для запуска неблокирующего веб-сервера FastCGI на указанном порту.")

3. Написать свой nginx.conf, который будет проксировать все запросы с 81 порта на 127.0.0.1:8080

![3.5](https://i.imgur.com/3HUiIgt.png "/etc/nginx/nginx.conf задали стандартные натройки и подключили файл default.conf")

![3.6](https://i.imgur.com/7E5f663.png "/etc/nginx/conf.d/default.conf Прописали еще дин сервес, который прослушивает 81 порт, fastcgi_pass 127.0.0.1:8080 - это директива, которая указывает, что запросы, поступающие в этот контекст, должны быть переданы в FastCGI-сервер, который работает на адресе 127.0.0. (localhost) и порту 8080. Это означает, что этот контекст использует FastCGI-протокол для обработки запросa")

4. Проверить, что в браузере по localhost:81 отдается написанная вами страничка

![3.7](https://i.imgur.com/ubn2uEi.png "3.7 Cтраничка отдается")

## Part 4. Свой докер ##

1. Написать свой докер образ, который:

1) собирает исходники мини сервера на FastCgi из Части 3
2) запускает его на 8080 порту
3) копирует внутрь образа написанный ./nginx/nginx.conf
4) запускает nginx.

![4.1](https://i.imgur.com/g8mBeRJ.png)

2. Собрать написанный докер образ через docker build при этом указав имя и тег

![4.2](https://i.imgur.com/RDGYfG2.png "4.2 Собрался dockerfile без ошибок")

3. Проверить через docker images, что все собралось корректно

![4.3](https://i.imgur.com/aRD8kEp.png "4.3 Все собралось корректно")

4. Запустить собранный докер образ с маппингом 81 порта на 80 на локальной машине и маппингом папки ./nginx внутрь контейнера по адресу, где лежат конфигурационные файлы nginx'а (см. Часть 2)

![4.4](https://i.imgur.com/rPsboru.png "4.4 Создали VOLUME, при запуске контейнера необходимо создать директорию на хосте, заполненную данными из образа, и смонтировать в указанной точке внутри контейнера" )

5. Проверить, что по localhost:80 доступна страничка написанного мини сервера

![4.5](https://i.imgur.com/oBABBT5.png "4.5 Cтраничка доступна")

6. Дописать в ./nginx/nginx.conf проксирование странички /status, по которой надо отдавать статус сервера nginx

![4.6](https://i.imgur.com/IbeOVDo.png "4.6 Добавили location /status" )

7. Проверить, что теперь по localhost:80/status отдается страничка со статусом nginx

![4.7](https://i.imgur.com/oRm82Xv.png "4.7 Cтраничка отдается со статусом nginx ")

## Part 5. Dockle ##

1. Просканировать образ из предыдущего задания через dockle [image_id|repository]

![5.3](https://i.imgur.com/NX451EA.png "4.8 Образ взят Debian:12 для исправление ошибки. Так же очистили кэш пакетного менеджера apt. Добавили пользователя")

2. Исправить образ так, чтобы при проверке через dockle не было ошибок и предупреждений

![5.2](https://i.imgur.com/lFlEKTS.png "5.2 Ошибок и предупреждений нет")

## Part 6. Базовый Docker Compose ## 

Написать файл docker-compose.yml, с помощью которого:

1) Поднять докер контейнер из Части 5 (он должен работать в локальной сети, т.е. не нужно использовать инструкцию EXPOSE и мапить порты на локальную машину)

2) Поднять докер контейнер с nginx, который будет проксировать все запросы с 8080 порта на 81 порт первого контейнера

Замапить 8080 порт второго контейнера на 80 порт локальной машины

![6.1](https://i.imgur.com/AYK5lEJ.png "6.1 Создаем docker-compose.yml. Прописываем порты у proxy 80:8080, создаем общую сеть")

![6.2](https://i.imgur.com/b0VN0qO.png "6.2 Dockerfile контейнера который будет проксировать все запросы с 8080 порта на 81 порт первого контейнера")

![6.3](https://i.imgur.com/RxHBrf2.png "6.3 Прослушивается порт 8080, все запросы поподают в контейнер web (так как мы дали им общую сеть, мы можем обратиться по имени контейнера) на 81 порт")

Собрать и запустить проект с помощью команд docker-compose build и docker-compose up

![6.4](https://i.imgur.com/8v1tGQW.png "6.4 docker-compose build выполняет сборку сервисов, описанных в файле docker-compose.yml. docker-compose up используется для запуска сервисов, описанных в файле docker-compose.yml.")

Проверить, что в браузере по localhost:80 отдается написанная вами страничка, как и ранее

![6.6](https://i.imgur.com/oqvHdYw.png "6.6 Страничка отдается")